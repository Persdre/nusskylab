!function(b){"use strict";var f=b.tablesorter.editable={namespace:".tseditable",lastEdited:"tseditable-last-edited-cell",editComplete:function(e,t,n,i){e.$table.find("."+f.lastEdited).removeClass(f.lastEdited).trigger(t.editable_editComplete,[e]),i&&setTimeout(function(){n.focus()},50)},selectAll:function(n){setTimeout(function(){var e,t;document.body.createTextRange?((e=document.body.createTextRange()).moveToElementText(n),e.select()):window.getSelection&&(t=window.getSelection(),(e=document.createRange()).selectNodeContents(n),t.removeAllRanges(),t.addRange(e))},100)},getColumns:function(e,t){var n,i,o,a,l,d=t.editable_columns,r=[];if("string"==typeof d)for(a=(n=d.replace(/\s+/,"").split(/,/)).length-1;0<=a;){if(0<=n[a].indexOf("-"))for(o=n[a].split("-"),i=parseInt(o[0],10)||0,(o=parseInt(o[1],10)||e.columns-1)<i&&(l=i,i=o,o=l);i<=o;i++)r.push("td:nth-child("+(i+1)+")");else r.push("td:nth-child("+((parseInt(n[a],10)||0)+1)+")");a--}else if(b.isArray(d))for(a=d.length,i=0;i<a;i++)d[i]<e.columns&&r.push("td:nth-child("+(d[i]+1)+")");return r},update:function(e,t){var n,i,o,a,l,d,r,s=b("<div>").wrapInner(t.editable_wrapContent).children().length||b.isFunction(t.editable_wrapContent),c=f.getColumns(e,t).join(",");for(e.$tbodies.find(c).find("[contenteditable]").prop("contenteditable",!1),a=(i=e.$tbodies.find(c).not("."+t.editable_noEdit)).length,o=0;o<a;o++)if(n=i.eq(o),s&&0===n.children("div, span").length&&n.wrapInner(t.editable_wrapContent),r=(l=n.children("div, span").not("."+t.editable_noEdit)).length)for(d=0;d<r;d++){var u=l.eq(d);t.editable_trimContent&&u.html(function(e,t){return b.trim(t)}),u.prop("contenteditable",!0)}else t.editable_trimContent&&n.html(function(e,t){return b.trim(t)}),n.prop("contenteditable",!0)},bindEvents:function(d,r){var s=f.namespace;d.$table.off("updateComplete pagerComplete ".split(" ").join(s+" ").replace(/\s+/g," ")).on("updateComplete pagerComplete ".split(" ").join(s+" "),function(){f.update(d,d.widgetOptions)}).children("thead").add(b(d.namespace+"_extra_table").children("thead")).off("mouseenter"+s).on("mouseenter"+s,function(){d.$table.data("contentFocused")&&(d.$table.data("contentFocused",!0),b(":focus").trigger("focusout"))}),d.$tbodies.off("focus blur focusout keydown ".split(" ").join(s+" ").replace(/\s+/g," ")).on("focus"+s,"[contenteditable]",function(e){clearTimeout(b(this).data("timer")),d.$table.data("contentFocused",e.target),d.table.isUpdating=!0;var t=b(this),n=r.editable_selectAll,i=t.closest("td").index(),o=t.html();r.editable_trimContent&&(o=b.trim(o)),t.off("keydown"+s).on("keydown"+s,function(e){r.editable_enterToAccept&&13===e.which&&!e.shiftKey&&e.preventDefault()}),t.data({before:o,original:o}),"function"==typeof r.editable_focused&&r.editable_focused(o,i,t),n&&("function"==typeof n?n(o,i,t)&&f.selectAll(t[0]):f.selectAll(t[0]))}).on("blur focusout keydown ".split(" ").join(s+" "),"[contenteditable]",function(e){if(d.$table.data("contentFocused")){var t,n,i=!1,o=b(e.target),a=o.html(),l=o.closest("td").index();if(r.editable_trimContent&&(a=b.trim(a)),27===e.which)return o.html(o.data("original")).trigger("blur"+s),d.$table.data("contentFocused",!1),d.table.isUpdating=!1;if((t=13===e.which&&!e.shiftKey&&(r.editable_enterToAccept||e.altKey)||r.editable_autoAccept&&"keydown"!==e.type)&&o.data("before")!==a){if(n=r.editable_validate,i=a,"function"==typeof n?i=n(a,o.data("original"),l,o):"function"==typeof(n=b.tablesorter.getColumnData(d.table,n,l))&&(i=n(a,o.data("original"),l,o)),t&&!1!==i)return d.$table.find("."+f.lastEdited).removeClass(f.lastEdited),o.addClass(f.lastEdited).html(i).data("before",i).data("original",i).trigger("change"),d.$table.trigger("updateCell",[o.closest("td"),!1,function(){r.editable_autoResort?setTimeout(function(){d.$table.trigger("sorton",[d.sortList,function(){f.editComplete(d,r,d.$table.data("contentFocused"),!0)},!0])},10):f.editComplete(d,r,d.$table.data("contentFocused"))}]),!1}else i||"keydown"===e.type||(clearTimeout(o.data("timer")),o.data("timer",setTimeout(function(){d.table.isUpdating=!1,b.isFunction(r.editable_blur)&&(a=o.html(),r.editable_blur(r.editable_trimContent?b.trim(a):a,l,o))},100)),o.html(o.data("original")))}})},destroy:function(e,t){var n=f.namespace,i=f.getColumns(e,t),o="updateComplete pagerComplete ".split(" ").join(n+" ").replace(/\s+/g," ");e.$table.off(o),o="focus blur focusout keydown ".split(" ").join(n+" ").replace(/\s+/g," "),e.$tbodies.off(o).find(i.join(",")).find("[contenteditable]").prop("contenteditable",!1)}};b.tablesorter.addWidget({id:"editable",options:{editable_columns:[],editable_enterToAccept:!0,editable_autoAccept:!0,editable_autoResort:!1,editable_wrapContent:"<div>",editable_trimContent:!0,editable_validate:null,editable_focused:null,editable_blur:null,editable_selectAll:!1,editable_noEdit:"no-edit",editable_editComplete:"editComplete"},init:function(e,t,n,i){i.editable_columns.length&&(f.update(n,i),f.bindEvents(n,i))},remove:function(e,t,n,i){i||f.destroy(t,n)}})}(jQuery);